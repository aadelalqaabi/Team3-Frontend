{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { makeAutoObservable } from \"mobx\";\nimport { instance } from \"./instance\";\nimport decode from \"jwt-decode\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nvar AuthStore = _createClass(function AuthStore() {\n  var _this = this;\n\n  _classCallCheck(this, AuthStore);\n\n  this.user = null;\n\n  this.setUser = function _callee(token) {\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"myToken\", JSON.stringify(token)));\n\n          case 2:\n            instance.defaults.headers.common.Authorization = \"Bearer \" + token;\n            _this.user = decode(token);\n            console.log(decode(token));\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  this.checkForToken = function _callee2() {\n    var token, jsonValue, currentTime, user;\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            token = null;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"myToken\"));\n\n          case 3:\n            jsonValue = _context2.sent;\n            if (jsonValue !== null) token = JSON.parse(jsonValue);\n\n            if (token) {\n              currentTime = Date.now();\n              user = decode(token);\n\n              if (user.exp >= currentTime) {\n                _this.setUser(token);\n              } else {\n                _this.logout();\n              }\n            }\n\n          case 6:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  this.register = function _callee3(newUser) {\n    var response;\n    return _regeneratorRuntime.async(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(instance.post(\"/register\", newUser));\n\n          case 3:\n            response = _context3.sent;\n\n            _this.setUser(response.data.token);\n\n            _context3.next = 10;\n            break;\n\n          case 7:\n            _context3.prev = 7;\n            _context3.t0 = _context3[\"catch\"](0);\n            console.log(_context3.t0);\n\n          case 10:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.login = function _callee4(userData) {\n    var response;\n    return _regeneratorRuntime.async(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(instance.post(\"/login\", userData));\n\n          case 3:\n            response = _context4.sent;\n\n            _this.setUser(response.data.token);\n\n            _context4.next = 10;\n            break;\n\n          case 7:\n            _context4.prev = 7;\n            _context4.t0 = _context4[\"catch\"](0);\n            console.log(_context4.t0);\n\n          case 10:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.logout = function () {\n    _this.user = null;\n    AsyncStorage.removeItem(\"myToken\");\n    delete instance.defaults.headers.common.Authorization;\n  };\n\n  this.updateUser = function _callee5(updatedUser) {\n    var formData, key, res;\n    return _regeneratorRuntime.async(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.prev = 0;\n            formData = new FormData();\n\n            for (key in updatedUser) {\n              formData.append(key, updatedUser[key]);\n            }\n\n            _context5.next = 5;\n            return _regeneratorRuntime.awrap(instance.put(\"/\", formData));\n\n          case 5:\n            res = _context5.sent;\n\n            if (updatedUser.bio || updatedUser.image) {\n              console.log(\"ðŸš€ ~ file: authStore.js ~ line 65 ~ AuthStore ~ updateUser= ~ updatedUser.bio\", _objectSpread(_objectSpread({}, _this.user), {}, {\n                bio: res.data.bio\n              }));\n              _this.user = _objectSpread(_objectSpread({}, _this.user), {}, {\n                bio: res.data.bio,\n                image: res.data.image\n              });\n            }\n\n            _context5.next = 12;\n            break;\n\n          case 9:\n            _context5.prev = 9;\n            _context5.t0 = _context5[\"catch\"](0);\n            console.log(_context5.t0);\n\n          case 12:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, [[0, 9]], Promise);\n  };\n\n  makeAutoObservable(this);\n});\n\nvar authStore = new AuthStore();\nauthStore.checkForToken();\nexport default authStore;","map":{"version":3,"names":["makeAutoObservable","instance","decode","AsyncStorage","AuthStore","user","setUser","token","setItem","JSON","stringify","defaults","headers","common","Authorization","console","log","checkForToken","getItem","jsonValue","parse","currentTime","Date","now","exp","logout","register","newUser","post","response","data","login","userData","removeItem","updateUser","updatedUser","formData","FormData","key","append","put","res","bio","image","authStore"],"sources":["/Users/adool998/Development/react-native/team3/Team3-Frontend/Team3/stores/authStore.js"],"sourcesContent":["import { makeAutoObservable } from \"mobx\";\nimport { instance } from \"./instance\";\nimport decode from \"jwt-decode\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\n\nclass AuthStore {\n  constructor() {\n    makeAutoObservable(this);\n  }\n  user = null;\n\n  setUser = async (token) => {\n    await AsyncStorage.setItem(\"myToken\", JSON.stringify(token));\n    instance.defaults.headers.common.Authorization = `Bearer ${token}`;\n    this.user = decode(token);\n    console.log(decode(token));\n  };\n\n  checkForToken = async () => {\n    let token = null;\n    const jsonValue = await AsyncStorage.getItem(\"myToken\");\n    if (jsonValue !== null) token = JSON.parse(jsonValue);\n    if (token) {\n      const currentTime = Date.now();\n      const user = decode(token);\n      if (user.exp >= currentTime) {\n        this.setUser(token);\n      } else {\n        this.logout();\n      }\n    }\n  };\n\n  register = async (newUser) => {\n    try {\n      const response = await instance.post(\"/register\", newUser);\n      this.setUser(response.data.token);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  login = async (userData) => {\n    try {\n      const response = await instance.post(\"/login\", userData);\n      this.setUser(response.data.token);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  logout = () => {\n    this.user = null;\n    AsyncStorage.removeItem(\"myToken\");\n    delete instance.defaults.headers.common.Authorization;\n  };\n\n  updateUser = async (updatedUser) => {\n    try {\n      const formData = new FormData();\n      for (const key in updatedUser) formData.append(key, updatedUser[key]);\n      const res = await instance.put(\"/\", formData);\n      // console.log(res.data, updatedUser.bio, updatedUser.image);\n      if (updatedUser.bio || updatedUser.image) {\n        console.log(\n          \"ðŸš€ ~ file: authStore.js ~ line 65 ~ AuthStore ~ updateUser= ~ updatedUser.bio\",\n\n          { ...this.user, bio: res.data.bio }\n        );\n        this.user = { ...this.user, bio: res.data.bio, image: res.data.image };\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n}\n\n/*\nObject {\n  \"bio\": \"\",\n  \"exp\": 1655919668363,\n  \"iat\": 1655910668,\n  \"id\": \"62b3310b0152cf6552a483eb\",\n  \"image\": \"\",\n  \"trips\": Array [],\n  \"username\": \"Newusername\",\n}\n*/\n\nconst authStore = new AuthStore();\nauthStore.checkForToken();\nexport default authStore;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}